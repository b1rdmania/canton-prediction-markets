<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angle on Canton - Real events. Real money. Better angles.</title>
    <meta name="description" content="Browse prediction markets with AI scores and quality ratings. Live data from Polymarket.">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://angle-on-canton.vercel.app/">
    <meta property="og:title" content="Angle on Canton - Real events. Real money. Better angles.">
    <meta property="og:description" content="Browse prediction markets with AI scores and quality ratings. Live data from Polymarket.">
    <meta property="og:image" content="https://angle-on-canton.vercel.app/share-card.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://angle-on-canton.vercel.app/">
    <meta property="twitter:title" content="Angle on Canton - Real events. Real money. Better angles.">
    <meta property="twitter:description" content="Browse prediction markets with AI scores and quality ratings. Live data from Polymarket.">
    <meta property="twitter:image" content="https://angle-on-canton.vercel.app/share-card.png">

    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <a href="index.html" class="nav__logo">angle on canton</a>
        <div class="nav__menu">
            <a href="#markets" class="nav__link">Markets</a>
            <a href="ai-insights.html" class="nav__link">AI Chat</a>
            <a href="research.html" class="nav__link">Research</a>
            <a href="#predictions" class="nav__link">My Predictions</a>
            <a href="about.html" class="nav__link">About</a>
            <a href="#markets" class="nav__cta">Browse Markets</a>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="section" style="padding: 48px 0 32px;">
        <div class="container">
            <div class="grid grid--50-50">
                <div>
                    <h1 class="headline-hero">REAL EVENTS.<br>REAL MONEY.<br>BETTER ANGLES.</h1>
                    <p class="text-body-large" style="margin-bottom: 24px; max-width: 480px;">
                        Browse live markets. See AI scores. Track your predictions.
                    </p>
                    <div class="flex gap-lg">
                        <a href="#markets" class="btn btn--primary">Browse Markets</a>
                        <a href="about.html" class="btn btn--secondary">Learn More</a>
                    </div>
                    <div style="display: flex; gap: 24px; margin-top: 24px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 8px; height: 8px; border-radius: 50%; background: var(--color-success);"></div>
                            <span class="text-small" style="font-family: var(--font-mono); text-transform: uppercase; letter-spacing: 0.05em;">Live Data</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div id="aiStatus" style="width: 8px; height: 8px; border-radius: 50%; background: var(--color-text-secondary);"></div>
                            <span class="text-small" style="font-family: var(--font-mono); text-transform: uppercase; letter-spacing: 0.05em;">AI Ready</span>
                        </div>
                    </div>
                </div>
                <div style="display: flex; justify-content: center; align-items: center;">
                    <svg viewBox="0 0 400 400" style="width: 100%; max-width: 400px; height: auto;">
                        <line x1="80" y1="100" x2="200" y2="150" stroke="var(--color-border)" stroke-width="1" opacity="0.3"/>
                        <line x1="200" y1="150" x2="320" y2="120" stroke="var(--color-border)" stroke-width="1" opacity="0.3"/>
                        <line x1="320" y1="120" x2="300" y2="280" stroke="var(--color-border)" stroke-width="1" opacity="0.3"/>
                        <line x1="200" y1="150" x2="150" y2="300" stroke="var(--color-border)" stroke-width="1" opacity="0.3"/>
                        <line x1="80" y1="100" x2="150" y2="300" stroke="var(--color-border)" stroke-width="1" opacity="0.3"/>
                        <circle cx="80" cy="100" r="25" fill="var(--color-accent-primary)" opacity="0.9"/>
                        <circle cx="200" cy="150" r="20" fill="var(--color-accent-primary)" opacity="0.85"/>
                        <circle cx="320" cy="120" r="18" fill="var(--color-accent-primary)" opacity="0.8"/>
                        <circle cx="150" cy="300" r="22" fill="var(--color-accent-primary)" opacity="0.85"/>
                        <circle cx="300" cy="280" r="40" fill="var(--color-accent-primary)" opacity="0.95"/>
                    </svg>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats + Features Combined -->
    <section class="section" style="padding: 24px 0 48px;">
        <div class="container">
            <div class="stats-dashboard" style="margin-bottom: 32px;">
                <div class="stat-card stat-card--minimal">
                    <div class="stat-card__label">Markets</div>
                    <div class="stat-card__value" id="totalMarkets">--</div>
                </div>
                <div class="stat-card stat-card--minimal">
                    <div class="stat-card__label">24H Volume</div>
                    <div class="stat-card__value" id="totalVolume">--</div>
                </div>
                <div class="stat-card stat-card--minimal">
                    <div class="stat-card__label">Your Picks</div>
                    <div class="stat-card__value" id="totalPredictions">0</div>
                </div>
                <div class="stat-card stat-card--minimal">
                    <div class="stat-card__label">Avg Score</div>
                    <div class="stat-card__value" id="avgQuality">--</div>
                </div>
            </div>

            <div class="grid grid--4col grid--cards">
                <article class="feature-card">
                    <span class="feature-card__number">01</span>
                    <h3 class="feature-card__title">Score Markets</h3>
                    <p class="feature-card__text">Each market gets a score based on volume, spread, and activity.</p>
                </article>
                <article class="feature-card">
                    <span class="feature-card__number">02</span>
                    <h3 class="feature-card__title">AI Analysis</h3>
                    <p class="feature-card__text">Get plain-language insights on what the data shows.</p>
                </article>
                <article class="feature-card">
                    <span class="feature-card__number">03</span>
                    <h3 class="feature-card__title">Track Picks</h3>
                    <p class="feature-card__text">Record your predictions and see how they perform.</p>
                </article>
                <article class="feature-card">
                    <span class="feature-card__number">04</span>
                    <h3 class="feature-card__title">Live Data</h3>
                    <p class="feature-card__text">Real-time prices from Polymarket, updated constantly.</p>
                </article>
            </div>
        </div>
    </section>

    <div class="divider"></div>

    <!-- Markets Section -->
    <section class="section" id="markets" style="padding: 48px 0;">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; flex-wrap: wrap; gap: 16px;">
                <div>
                    <div class="section-label">Markets</div>
                    <h2 class="headline-section">ACTIVE MARKETS</h2>
                </div>
                <span class="text-small" style="font-family: var(--font-mono); text-transform: uppercase; letter-spacing: 0.05em; color: var(--color-text-secondary);">
                    Updated: <span id="lastUpdated">--:--</span>
                </span>
            </div>

            <div class="filter-bar">
                <div class="filter-bar__chips">
                    <button class="filter-chip filter-chip--active" onclick="filterMarkets('all')">All</button>
                    <button class="filter-chip" onclick="filterMarkets('high-quality')">Score 70+</button>
                    <button class="filter-chip" onclick="filterMarkets('high-volume')">High Volume</button>
                    <button class="filter-chip" onclick="filterMarkets('high-confidence')">Strong Signal</button>
                </div>
                <div class="filter-bar__sort">
                    <label class="label-form">Sort</label>
                    <select class="filter-select" id="sortSelect" onchange="sortMarkets(this.value)">
                        <option value="quality">Score</option>
                        <option value="volume">Volume</option>
                        <option value="probability">Probability</option>
                        <option value="newest">Newest</option>
                    </select>
                </div>
            </div>

            <div id="marketsLoading" style="padding: 60px; text-align: center;">
                <p class="text-body" style="color: var(--color-text-secondary);">Loading markets...</p>
            </div>
            <div id="marketsGrid" class="grid grid--3col grid--cards" style="display: none;"></div>
        </div>
    </section>

    <div class="divider"></div>

    <!-- Predictions Section -->
    <section class="section" id="predictions" style="padding: 48px 0;">
        <div class="container">
            <div class="section-label">Your Picks</div>
            <h2 class="headline-section" style="margin-bottom: 24px;">YOUR PREDICTIONS</h2>
            <div id="predictionsEmpty" style="padding: 32px; text-align: center;">
                <p class="text-body" style="color: var(--color-text-secondary);">No picks yet. Browse markets above to start.</p>
            </div>
            <div id="predictionsGrid" class="grid grid--3col grid--cards" style="display: none;"></div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer footer--simple">
        <div class="container">
            <div class="footer__row">
                <div class="footer__brand">
                    <div class="footer__logo">angle on canton</div>
                    <p class="footer__copyright">© 2026</p>
                </div>
                <div class="footer__links">
                    <a href="#markets" class="footer__link">Markets</a>
                    <a href="ai-insights.html" class="footer__link">AI Chat</a>
                    <a href="research.html" class="footer__link">Research</a>
                    <a href="about.html" class="footer__link">About</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Prediction Modal -->
    <div id="predictionModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: var(--z-modal); align-items: center; justify-content: center;">
        <div style="background: var(--color-bg-primary); border: var(--border-thin); max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div style="background: var(--color-text-primary); color: var(--color-text-inverted); padding: 20px 24px; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="font-family: var(--font-mono); font-size: 14px; text-transform: uppercase; letter-spacing: 0.1em; font-weight: 400;">Place Prediction</h2>
                <span onclick="closePredictionModal()" style="font-size: 24px; cursor: pointer; opacity: 0.7;">&times;</span>
            </div>
            <div style="padding: 32px 24px;">
                <div id="modalMarketInfo" style="background: var(--color-bg-tertiary); padding: 20px; margin-bottom: 24px;"></div>
                <form id="predictionForm" onsubmit="submitPrediction(event)">
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-family: var(--font-mono); font-size: 12px; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">Your Pick</label>
                        <select id="predictionOutcome" required style="width: 100%; padding: 12px 16px; border: var(--border-thin); font-family: var(--font-body); font-size: 16px; background: var(--color-bg-secondary);">
                            <option value="">Select...</option>
                            <option value="yes">YES</option>
                            <option value="no">NO</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-family: var(--font-mono); font-size: 12px; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">Amount (USD)</label>
                        <input type="number" id="predictionAmount" min="1" step="0.01" placeholder="100" required style="width: 100%; padding: 12px 16px; border: var(--border-thin); font-family: var(--font-body); font-size: 16px; background: var(--color-bg-secondary);">
                    </div>
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-family: var(--font-mono); font-size: 12px; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px;">Confidence: <span id="confidenceValue">5</span>/10</label>
                        <input type="range" id="confidenceLevel" min="1" max="10" value="5" style="width: 100%;">
                    </div>
                    <button type="submit" class="btn btn--primary btn--full-width">SUBMIT</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://wanna-flexible-sapphire-suburban.trycloudflare.com';
        let currentMarkets = [];
        let selectedMarket = null;
        let currentFilter = 'all';
        let currentSort = 'quality';

        document.getElementById('confidenceLevel')?.addEventListener('input', (e) => {
            document.getElementById('confidenceValue').textContent = e.target.value;
        });

        async function fetchMarkets() {
            try {
                const response = await fetch(`${API_BASE}/api/quality/top-markets?limit=30`);
                const data = await response.json();
                // Transform API response format to frontend format
                currentMarkets = (data.markets || []).map(m => ({
                    id: m.market_id,
                    question: m.question,
                    probability: Math.round(m.price * 100),
                    qualityScore: Math.round(m.quality?.total_score || 50),
                    volume: m.volume_24h || 0,
                    confidence: m.quality?.grade || 'C',
                    insight: `Quality: ${m.quality?.grade || 'C'} • Volume: $${(m.volume_24h || 0).toLocaleString()}`
                }));
                displayMarkets();
                updateStats();
                updateLastUpdated();
                document.getElementById('aiStatus').style.background = 'var(--color-success)';
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('marketsLoading').innerHTML = '<p class="text-body" style="color: var(--color-danger);">Error loading markets. Try again later.</p>';
            }
        }

        function updateStats() {
            const totalMarkets = currentMarkets.length;
            const totalVolume = currentMarkets.reduce((sum, m) => sum + (m.volume || 0), 0);
            const avgQuality = currentMarkets.length > 0 ? Math.round(currentMarkets.reduce((sum, m) => sum + m.qualityScore, 0) / currentMarkets.length) : 0;

            document.getElementById('totalMarkets').textContent = totalMarkets;
            document.getElementById('totalVolume').textContent = formatVolume(totalVolume);
            document.getElementById('avgQuality').textContent = avgQuality + '/100';

            const predictions = JSON.parse(localStorage.getItem('predictions') || '[]');
            document.getElementById('totalPredictions').textContent = predictions.length;
        }

        function filterMarkets(type) {
            currentFilter = type;
            document.querySelectorAll('.filter-chip').forEach(btn => btn.classList.remove('filter-chip--active'));
            event.target.classList.add('filter-chip--active');
            displayMarkets();
        }

        function sortMarkets(type) {
            currentSort = type;
            displayMarkets();
        }

        function getFilteredMarkets() {
            let filtered = [...currentMarkets];
            switch(currentFilter) {
                case 'high-quality': filtered = filtered.filter(m => m.qualityScore >= 70); break;
                case 'high-volume': filtered = filtered.filter(m => (m.volume || 0) > 10000); break;
                case 'high-confidence': filtered = filtered.filter(m => { const p = parseFloat(m.probability); return p > 70 || p < 30; }); break;
            }
            switch(currentSort) {
                case 'quality': filtered.sort((a, b) => b.qualityScore - a.qualityScore); break;
                case 'volume': filtered.sort((a, b) => (b.volume || 0) - (a.volume || 0)); break;
                case 'probability': filtered.sort((a, b) => parseFloat(b.probability) - parseFloat(a.probability)); break;
                case 'newest': filtered.reverse(); break;
            }
            return filtered;
        }

        function displayMarkets() {
            const grid = document.getElementById('marketsGrid');
            const loading = document.getElementById('marketsLoading');
            const filtered = getFilteredMarkets();

            if (filtered.length === 0) {
                loading.style.display = 'block';
                loading.innerHTML = '<p class="text-body" style="color: var(--color-text-secondary);">No markets match filters.</p>';
                grid.style.display = 'none';
                return;
            }
            loading.style.display = 'none';
            grid.style.display = 'grid';
            grid.innerHTML = filtered.map(market => createMarketCard(market)).join('');
        }

        function createMarketCard(market) {
            const category = detectCategory(market.question);
            const activity = (market.volume || 0) > 50000 ? 'High' : (market.volume || 0) > 10000 ? 'Medium' : 'Low';
            return `
                <article class="market-card" data-category="${category}" onclick="openPredictionModal('${market.id}')">
                    <div class="market-card__header">
                        <span>ACTIVE</span>
                        <span>SCORE: ${market.qualityScore}/100</span>
                    </div>
                    <div class="market-card__category-bar">${category} • ${activity}</div>
                    <div class="market-card__body">
                        <h3 class="market-card__title">${market.question}</h3>
                        <div class="market-card__probability">${market.probability}%</div>
                        <p class="market-card__insight">${market.insight}</p>
                        <div class="market-card__stats">
                            <div class="stat"><span class="stat__label">Vol</span><span class="stat__value">${formatVolume(market.volume)}</span></div>
                            <div class="stat"><span class="stat__label">Signal</span><span class="stat__value">${market.confidence || 'Med'}</span></div>
                        </div>
                    </div>
                    <button class="market-card__cta">Place Pick</button>
                </article>
            `;
        }

        function detectCategory(q) {
            const l = q.toLowerCase();
            if (l.match(/election|president|congress|senate|political|democrat|republican/)) return 'politics';
            if (l.match(/bitcoin|crypto|eth|blockchain|nft|token/)) return 'crypto';
            if (l.match(/nfl|nba|football|soccer|sports|championship|game|team/)) return 'sports';
            if (l.match(/movie|oscar|actor|film|celebrity|music|album/)) return 'entertainment';
            if (l.match(/stock|company|business|economy|market|trade/)) return 'business';
            if (l.match(/science|research|discovery|nobel|space|climate/)) return 'science';
            return 'general';
        }

        function formatVolume(v) {
            if (!v) return '$0';
            if (v >= 1000000) return `$${(v / 1000000).toFixed(1)}M`;
            if (v >= 1000) return `$${(v / 1000).toFixed(1)}K`;
            return `$${Math.round(v)}`;
        }

        function updateLastUpdated() {
            document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }

        function openPredictionModal(marketId) {
            selectedMarket = currentMarkets.find(m => m.id === marketId);
            if (!selectedMarket) return;
            const info = document.getElementById('modalMarketInfo');
            info.innerHTML = `
                <div style="font-weight: 500; margin-bottom: 16px;">${selectedMarket.question}</div>
                <div style="display: flex; gap: 32px;">
                    <div><div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 4px;">Probability</div><div style="font-size: 24px; font-weight: 500; color: var(--color-accent-primary);">${selectedMarket.probability}%</div></div>
                    <div><div style="font-size: 12px; color: var(--color-text-secondary); margin-bottom: 4px;">Volume</div><div style="font-size: 24px; font-weight: 500;">${formatVolume(selectedMarket.volume)}</div></div>
                </div>
            `;
            document.getElementById('predictionModal').style.display = 'flex';
        }

        function closePredictionModal() {
            document.getElementById('predictionModal').style.display = 'none';
            document.getElementById('predictionForm').reset();
            selectedMarket = null;
        }

        function submitPrediction(event) {
            event.preventDefault();
            const prediction = {
                id: Date.now().toString(),
                marketId: selectedMarket.id,
                question: selectedMarket.question,
                outcome: document.getElementById('predictionOutcome').value,
                amount: parseFloat(document.getElementById('predictionAmount').value),
                confidence: parseInt(document.getElementById('confidenceLevel').value),
                probability: selectedMarket.probability,
                timestamp: new Date().toISOString()
            };
            const predictions = JSON.parse(localStorage.getItem('predictions') || '[]');
            predictions.push(prediction);
            localStorage.setItem('predictions', JSON.stringify(predictions));
            loadPredictions();
            updateStats();
            closePredictionModal();
            setTimeout(() => document.getElementById('predictions').scrollIntoView({ behavior: 'smooth' }), 100);
        }

        function loadPredictions() {
            const predictions = JSON.parse(localStorage.getItem('predictions') || '[]');
            const grid = document.getElementById('predictionsGrid');
            const empty = document.getElementById('predictionsEmpty');
            if (predictions.length === 0) { empty.style.display = 'block'; grid.style.display = 'none'; return; }
            empty.style.display = 'none';
            grid.style.display = 'grid';
            grid.innerHTML = predictions.map(pred => `
                <article class="market-card" style="opacity: 0.9;">
                    <div class="market-card__header"><span>${pred.outcome.toUpperCase()}</span><span>$${pred.amount}</span></div>
                    <div class="market-card__category-bar">Confidence: ${pred.confidence}/10</div>
                    <div class="market-card__body">
                        <h3 class="market-card__title">${pred.question}</h3>
                        <div class="market-card__probability">${pred.probability}%</div>
                        <p class="market-card__insight">Placed ${new Date(pred.timestamp).toLocaleDateString()}</p>
                    </div>
                </article>
            `).join('');
        }

        fetchMarkets();
        loadPredictions();
        setInterval(fetchMarkets, 300000);
    </script>
</body>
</html>
